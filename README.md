# goquorum-parser

**Конфигурация и запись сети goQuorum**

1. *Необходимо сгенерировать ключи для нод, а так же genesis-file при помощи утилиты npx quorum-genesis-tool. Ключевые моменты*:
- genesis-file включает в себя начальную конфигурацию сети которая определяется в момент инициализации (генезис-блок).
- тип консенсуса (рекомендуемо qbft)
- chainId - айдишка нужна для добавления конфигурации сети в chainlist, а так же для добавления сети по индентификатору в метамаск
- время генерации блока (так же можно задать время генерации блока без транзакций)
- количество нод - для продакшн конфигурации рекомендуется использовать 2 бутноды - они нужны для синхронизации между остальными нодами и обеспечивают дополнительную отказоустойчивость, запускалась сеть со следующей конфигурацией - 1 rpc-нода (сгенерирована была 1 доп мембер нода и указана в docker-compose как рпс нода), 3 валидатора, 3 мембер-ноды (так как модель приватность транзакций включена в конфигурацию то каждая мембер-нода имеет в паре tesseta private transactions manager
- enableGasPriceBlock - можно включить газ за транзакции, по дефолту сеть без газа за транзакции, конфигурация настраивается в зависимости от выбранного типа консенсуса
- genesis предоставляет возможность задать балансы нативной валюты для любых кошельков прописанных в файле, а так же возможность предеплоя контрактов
- так же quorum предоставляет возможность включать фичи с определнного блока (нужно проверять и уточнять отдельные фичи)

2. *Приватность*

- Мы создаём 2 генезиса, один из них используется с включенным флагом privacyEnhancementsEnabled
- в docker-compose необходимо добавить для каждой member-ноды по ptm необходимо прописать конфигурацию ptm в docker-entrypoiint.sh

3. Урлы всех нод необходимо обновить в сгенеренных permissioned-nodes.json и static-nodes.json

4. Создать docker-compose включая все необходимые ноды, сервисы для мониторинга, блок-експлорер blockscout

5. в docker-entrypoint.sh запускается команда geth которая инициализирует из генезис файла сеть и запускает её с опредёлнными параметрами указанными в самой команде, такие как включение ptm, порты rpc, консенсус и так далее



**Permissioning**

- Для контроля за добавлением/удалением нод а так же для ограничения прав пользователей (например кошелёк без прав не может выполнить транзакцию на смарт-контракте в сети) внутри сети - quorum предоставляет набор смарт-контрактов.
- Набор контрактов находится в репозитории, а так же набор скриптов для деплоя. После деплоя происходит инициализация контрактов (в скрипте необходимо указать набор ключей аккаунтов которые будут обладать правами супер-админа в сети и будут иметь право на добавление организаций, нод, а так же на подписание транзакций смарт-контрактов - по дефолту это аккаунты всех нод)

![image](https://github.com/user-attachments/assets/8ae70a99-830e-4c4e-8255-2e7f828bc8ff)


**Деплой  и взаимодействие со смарт-контрактами**

- Для деплоя контрактов в репозитории предоставлены скрипты. Необходимо так же использовать опредёлнную смарт-контрактом версию компилятора. Для теста был задплоен смарт-контракт usdt, а так же произведены транзакции с сервиса-парсера и парсинг евентов.


**Приватность**

Quorum предоставляет 3 уровня настройки приватности транзакций:

1. Internal private transaction - По-дефолту мы можем определить область видимости *логов* транзакции задав параметр privateFor при создании транзакции
2. Privacy enhancements чтобы задать уровень приватность при отправки транзакций при помощи параметра privateFlag который определяет мод этой фичи, более подробно https://docs.goquorum.consensys.io/concepts/privacy/privacy-enhancements
3. Privacy transaction marker как более приватный уровень (скрыто to, nonce) работает при соответсвующих настройках и включённом privacy enhancements

**Полезные ссылки**
- репозиторий который был создан для ресёрча, включает сконфигурированную сеть и парсер-бекенд сервис для парсинга евентов и взаимодействия со смартами https://github.com/salesforceanton/goquorum-parser
- ссылка но официальную доку кворума https://docs.goquorum.consensys.io/
